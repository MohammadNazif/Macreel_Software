<div class="relative overflow-x-auto overflow-y-auto mb-2 ms-1 rounded-lg border border-gray-200"
     style="max-height: 72vh;"
     (scroll)="onScroll($event)">
  <table class="w-full min-w-[950px] text-[12px] text-left border-collapse">

    <!-- Table Header -->
    <thead class="sticky top-0 z-10 bg-[#dd3d4f]">
      <tr class="text-white border-b border-[#ccc]">
        <th class="w-[1.5px] px-1 py-0 overflow-hidden whitespace-nowrap border-r border-[#ccc]">
          S.N.
        </th>

        <th *ngFor="let col of columns"
            class="px-2 py-1 font-semibold border-r border-[#ccc]"
            [style.width]="col.width || 'auto'"
            [style.text-align]="col.align || 'left'">
          {{ col.label }}
        </th>

        <th *ngIf="showActions" class="px-2 py-1 text-center font-semibold border-r border-[#ccc]">Action</th>
      </tr>
    </thead>

    <!-- Table Body -->
  <tbody>
  <tr *ngFor="let item of data; let i = index"
      class="border-b border-[#e1e1e1] hover:bg-gray-50 transition">
    
    <!-- Serial Number -->
    <td class="px-2 py-1 text-gray-500 font-medium border-r border-[#e1e1e1]">
      {{ i + 1 }}
    </td>

    <!-- Dynamic Columns -->
    <td *ngFor="let col of columns"
        class="px-2 py-1 text-gray-700 border-r border-[#e1e1e1]"
        [style.text-align]="col.align || 'left'">

      <!-- Custom Template -->
      <ng-container *ngIf="col.template; else defaultCell">
        <ng-container *ngTemplateOutlet="col.template; context: { $implicit: item }"></ng-container>
      </ng-container>

      <!-- Default Cell -->
      <ng-template #defaultCell>

        <!-- Clickable Cell -->
        <a *ngIf="col.clickable"
           class="text-[#dd3d4f] hover:underline cursor-pointer font-medium"
           (click)="onCellClick(item, col)">
          {{ item[col.key] }}
        </a>

        <!-- Date -->
        <span *ngIf="col.type === 'date' && !col.clickable">
          {{ formatCell(item, col) }}
        </span>

        <!-- Checkbox -->
        <ng-container *ngIf="col.type === 'checkbox'">
          <input type="checkbox" 
                 [checked]="item[col.key]"
                 (change)="onCheckboxChange(item,col.key, $event)"
                 class="mx-auto" />
        </ng-container>

        <!-- Number -->
        <ng-container *ngIf="col.type === 'number'">
          <input type="number"  
                 [value]="item[col.key]"
                 (change)="onNumberChange(item, col.key, $event)"
                 class="w-12 px-1 py-0.5 text-center border rounded text-gray-700 text-sm" />
        </ng-container>

        <!-- Text -->
        <span *ngIf="(!col.type || col.type === 'text') && !col.clickable">
          {{ item[col.key] }}
        </span>

      </ng-template>
    </td>

    <!-- Actions Column -->
    <td *ngIf="showActions" class="px-2 py-1 border-r border-[#e1e1e1]">
      <div class="flex justify-center gap-1">

        <!-- Edit -->
        <button class="w-6 h-6 flex items-center justify-center rounded border
                       border-green-500 text-green-500
                       hover:bg-green-500 hover:text-white
                       transition-all duration-150"
                (click)="edit.emit(item)"
                title="Edit">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none"
               viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M4 20h4l10.5-10.5a2.12 2.12 0 10-3-3L5 17v3z"/>
          </svg>
        </button>

        <!-- Delete -->
        <button class="w-6 h-6 flex items-center justify-center rounded border
                       border-red-500 text-red-500
                       hover:bg-red-500 hover:text-white
                       transition-all duration-150"
                (click)="delete.emit(item)"
                title="Delete">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none"
               viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M6 7h12M9 7V4h6v3M8 7l1 13h6l1-13"/>
          </svg>
        </button>

      </div>
    </td>

  </tr>

  <!-- Empty / Loading States -->
  <tr *ngIf="!loading && data?.length === 0">
    <td [attr.colspan]="columns.length + (showActions ? 2 : 1)"
        class="py-8 text-center text-gray-400 border-r border-[#e1e1e1]">
      No records found
    </td>
  </tr>

  <tr *ngIf="loading">
    <td [attr.colspan]="columns.length + (showActions ? 2 : 1)"
        class="py-8 text-center border-r border-[#e1e1e1]">
      Loading...
    </td>
  </tr>
</tbody>

  </table>
</div>
