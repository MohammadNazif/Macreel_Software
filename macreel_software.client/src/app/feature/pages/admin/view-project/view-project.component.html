<div class="bg-white rounded-2xl shadow-sm mt-1  px-4 md:px-6 py-4  md:mx-auto  font-[Poppins]">
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-3 mb-3">
    <h2 class="text-sm font-semibold text-gray-700">Project List</h2>

    <form [formGroup]="searchForm" class="relative w-full md:w-60">
      <input type="text" formControlName="search" placeholder="Search projects"
        class="w-full h-8 rounded-lg border border-gray-300 pl-8 pr-3 text-[12px] text-gray-700 placeholder:text-gray-400 focus:outline-none focus:ring-1 focus:ring-[#dd3d4f] focus:border-[#dd3d4f]" />
    </form>
  </div>

  <app-generic-table [columns]="projectColumns" [data]="paginator.items" [loading]="paginator.loading"
    (edit)="edit($event)" (delete)="Delete($event)" (tableScroll)="onScroll($event)">
  </app-generic-table>
</div>

<!-- <ng-template #filesTemplate let-row>
  <span *ngIf="row.appEmpName" class="cursor-pointer text-blue-600"
    (click)="onEmployeeClick(row.appEmpId,row.id ,'app')">
    {{ row.appEmpName }}
  </span>
</ng-template>


<ng-template #webTemplate let-row>
  <span *ngIf="row.webEmpName" class="cursor-pointer text-green-600"
    (click)="onEmployeeClick(row.webEmpId,row.id ,'web')">
    {{ row.webEmpName }}
  </span>
</ng-template> -->
<!-- APP EMPLOYEE TEMPLATE -->
<ng-template #appEmployeeTemplate let-row>
  <span *ngIf="row.app && row.appEmpName"
        class="text-blue-600 cursor-pointer"
        (click)="onEmployeeClick(row.appEmpId, row.id, 'app')">
    {{ row.appEmpName }}
  </span>
</ng-template>

<!-- WEB EMPLOYEE TEMPLATE -->
<ng-template #webEmployeeTemplate let-row>
  <span *ngIf="row.web && row.webEmpName"
        class="text-green-600 cursor-pointer"
        (click)="onEmployeeClick(row.webEmpId, row.id, 'web')">
    {{ row.webEmpName }}
  </span>
</ng-template>






<!-- Employee Modal (Static Design) -->
<div *ngIf="showEmployeeModal" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50">

  <div class="bg-white w-[600px] rounded-xl shadow-xl flex flex-col">

    <!-- ðŸ” HEADER WITH + ICON -->
    <div class="flex justify-between items-center px-4 py-2">
      <h3 class="font-semibold">Added Employees</h3>

      <div class="flex gap-2">
        <button class="w-8 h-8 flex items-center justify-center rounded-full
                 bg-[#C5192F] text-white hover:bg-red-600" (click)="onAddEmployeeClick()">
          <i class="fa fa-plus text-sm"></i>
        </button>

        <button (click)="closeModal()">âœ•</button>
      </div>
    </div>

    <!-- ðŸŸ¦ CHIPS + ADD BUTTON (SAME ROW) -->
    <div class="px-4 py-2 flex items-center gap-2 border-b max-h-[80px]">

      <!-- CHIPS -->
      <div class="flex flex-wrap gap-2 flex-1 overflow-auto">
        <ng-container *ngFor="let emp of selectedEmployees">
          <span class="flex items-center gap-1 bg-gray-200 text-sm px-2 py-1 rounded-full">
            {{ emp.empName }}
            <button class="text-red-500" (click)="removeChip(emp)">âœ•</button>
          </span>
        </ng-container>
      </div>

      <!-- ADD BUTTON -->
      <!-- <button *ngIf="showAddIcon" class="flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-full
           bg-green-600 text-white hover:bg-green-700" title="Add to table" (click)="addEmployeesToTable()"  (click)="saveEmployees()">
        <i class="fa fa-check text-xs"></i>
      </button> -->

      <button *ngIf="showAddIcon" class="flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-full
         bg-green-600 text-white hover:bg-green-700" title="Add & Save" (click)="addAndSaveEmployees()">
        <i class="fa fa-check text-xs"></i>
      </button>


    </div>



    <!-- ðŸ“‹ EMPLOYEE LIST (API DATA) -->
    <div *ngIf="showEmployeeDropdown" class="px-4 py-2 max-h-40 overflow-auto border-b" style="max-height: 80px;">

      <div *ngFor="let emp of allEmployees" class="cursor-pointer px-2 py-1 rounded text-sm hover:bg-gray-200"
        (click)="addChip(emp)">
        {{ emp.empName }} ({{ emp.designationName }})
      </div>

    </div>

    <!-- ðŸ“Š TABLE -->
    <div class="p-2 max-h-[300px] overflow-auto">
      <app-generic-table [columns]="employeeColumns" [data]="employees" [showActions]="false" [tableMaxWidth]="'600px'">
      </app-generic-table>
    </div>

    <!-- FOOTER -->
    <div class="flex justify-end px-3 py-2 border-t">
      <button class="px-3 py-1.5 text-sm bg-[#C5192F] text-white rounded-md hover:bg-red-600" (click)="saveEmployees()"
        (click)="submitApprovedEmployees()">
        Submit
      </button>
    </div>

  </div>
</div>


<ng-template #iconsTemplate let-row>
  <div class="flex gap-2">

    <!-- APPROVE -->
    <button class="px-2" [ngClass]="row.isApproved
        ? 'text-white bg-green-600 rounded'
        : 'text-green-600 hover:bg-green-100 rounded'" (click)="approveEmployee(row)">
      <i class="fa fa-check text-xs"></i>
    </button>

    <span class="w-px bg-gray-300"></span>

    <!-- REJECT -->
    <button class="px-2 text-red-600 hover:bg-red-100 rounded" (click)="openRejectModal(row)">
      <i class="fa fa-times text-xs"></i>
    </button>

  </div>
</ng-template>


<div *ngIf="showRejectModal" class="fixed inset-0 bg-black/40 flex items-center justify-center z-50">

  <div class="bg-white w-[400px] rounded-lg p-4">
    <h3 class="font-semibold mb-2">Reject Employee</h3>

    <textarea [(ngModel)]="rejectReason" class="w-full border rounded p-2 text-sm" placeholder="Enter rejection reason">
    </textarea>

    <div class="flex justify-end gap-2 mt-3">
      <button class="px-3 py-1 bg-gray-300 rounded" (click)="showRejectModal=false">
        Cancel
      </button>

      <button class="px-3 py-1 bg-red-600 text-white rounded" (click)="submitReject()">
        Submit
      </button>
    </div>
  </div>
</div>

