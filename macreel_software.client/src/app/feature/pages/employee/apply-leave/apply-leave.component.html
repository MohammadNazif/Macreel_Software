<div class="bg-gray-50 p-2 md:p-2">
    <!-- Form Section -->
    <div class="mb-2">
        <div class="bg-white shadow rounded-lg p-2">
            <h2 class="text-lg md:text-xl font-bold text-gray-800 mb-4">Leave Request</h2>

            <form [formGroup]="leaveForm" (ngSubmit)="onSubmit()" class="space-y-3">
                <!-- First Row: From Date, To Date, Leave Type, Description -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <!-- From Date -->
                    <div>
                        <label for="fromDate" class="block text-xs font-semibold text-gray-700 mb-1">
                            From Date
                        </label>
                        <input type="date" id="fromDate" formControlName="fromDate"
                            class="w-full px-3 py-2 border border-gray-300 rounded text-xs focus:outline-none focus:ring-1 focus:ring-[#dd3d4f]" />
                        <div *ngIf="isFieldInvalid('fromDate')" class="text-red-500 text-xs mt-1">
                            From date is required
                        </div>

                    </div>

                    <!-- To Date -->
                    <div>
                        <label for="toDate" class="block text-xs font-semibold text-gray-700 mb-1">
                            To Date
                        </label>
                        <input type="date" id="toDate" formControlName="toDate" [min]="leaveForm.get('fromDate')?.value"
                            class="w-full px-3 py-2 border rounded text-xs" />
                        <div *ngIf="isFieldInvalid('toDate')" class="text-red-500 text-xs mt-1">
                            To date is required
                        </div>
                        <div *ngIf="leaveForm.errors?.['invalidDateRange']" class="text-red-500 text-xs mt-1">
                            To date must be greater than or equal to From date
                        </div>
                    </div>

                    <!-- Leave Type -->
                    <div>
                        <label for="leaveType" class="block text-xs font-semibold text-gray-700 mb-1">
                            Leave Type
                        </label>
                        <select id="leaveType" formControlName="leaveType"
                            class="w-full px-3 py-2 border border-gray-300 rounded text-xs focus:outline-none focus:ring-1 focus:ring-[#dd3d4f] bg-white">
                            <option value="">Select</option>
                            <option *ngFor="let type of leaveTypeList" [value]="type.id">
                                {{ type.leaveName }}
                            </option>
                        </select>
                        <div *ngIf="isFieldInvalid('leaveType')" class="text-red-500 text-xs mt-1">
                            Leave type is required
                        </div>
                    </div>

                    <!-- Description -->
                    <div>
                        <label for="description" class="block text-xs font-semibold text-gray-700 mb-1">
                            Description
                        </label>
                        <input type="text" id="description" formControlName="description"
                            placeholder="Enter description"
                            class="w-full px-3 py-2 border border-gray-300 rounded text-xs focus:outline-none focus:ring-1 focus:ring-[#dd3d4f]" />
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-start pt-1">
                    <button type="submit" [disabled]="!leaveForm.valid"
                        class="px-6 py-2 bg-[#dd3d4f] text-white font-semibold rounded text-xs hover:bg-[#c2303f] transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        Submit
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Leave Balance Cards - Compact -->
    <div class="mb-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
        <!-- Total Leave Card -->
        <div class="bg-white shadow rounded-lg p-3">
            <h3 class="text-xs font-bold text-gray-700 mb-2">Total Leave</h3>
            <div class="space-y-1 text-xs">
                <div *ngFor="let lb of leaveBalanceList" class="flex justify-between">
                    <span class="text-gray-600">{{ lb.leaveType }}:</span>
                    <span class="font-bold text-[#dd3d4f]">
                        {{ totalLeave[lb.leaveType] || 0 }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Remaining Leave Card -->
        <div class="bg-white shadow rounded-lg p-3">
            <h3 class="text-xs font-bold text-gray-700 mb-2">Remaining Leave</h3>
            <div class="space-y-1 text-xs">
                <div *ngFor="let lb of leaveBalanceList" class="flex justify-between">
                    <span class="text-gray-600">{{ lb.leaveType }}:</span>
                    <span class="font-bold text-[#dd3d4f]">
                        {{ remainingLeave[lb.leaveType] || 0 }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Unapproved Leave Card -->
        <div class="bg-white shadow rounded-lg p-3">
            <h3 class="text-xs font-bold text-gray-700 mb-2">Unapproved Leave</h3>
            <div class="space-y-1 text-xs">
                <div *ngFor="let lb of leaveBalanceList" class="flex justify-between">
                    <span class="text-gray-600">{{ lb.leaveType }}:</span>
                    <span class="font-bold text-[#dd3d4f]">
                        {{ unapprovedLeave[lb.leaveType] || 0 }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Total LWP Taken -->
        <!-- <div class="bg-white shadow rounded-lg p-3">
            <h3 class="text-xs font-bold text-gray-700 mb-2">Total LWP</h3>
            <div class="flex items-center justify-center h-20">
                <span class="font-bold text-2xl text-[#dd3d4f]">0</span>
            </div>
        </div> -->
    </div>

    <!-- Leave History Table Section -->
    <div class="bg-white shadow rounded-lg p-1">

        <!-- HEADER -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-1 mb-1">

            <!-- LEFT SIDE: TITLE -->
            <h1 class="ml-2 text-lg md:text-[16px] font-semibold text-[#444] text-center md:text-left">
                Leave Request List
            </h1>

            <!-- RIGHT SIDE: SEARCH + PAGINATOR (together) -->
            <div class="flex items-center gap-2">

                <!-- SEARCH -->
                <div class="relative">
                    <input type="text" placeholder="Search Leave" [formControl]="searchControl" class="w-full pl-10 pr-3 py-[6px] text-[12px] rounded-lg bg-[#F6F7FB]
        border border-gray-300
        focus:outline-none focus:ring-2 focus:ring-[#C5192F] table-search" />
                    <i class="fa-solid fa-magnifying-glass
        absolute left-3 top-1/2 -translate-y-1/2
        text-gray-400 text-sm">
                    </i>
                </div>

                <!-- PAGINATOR -->
                <mat-paginator [length]="totalRecords" [pageSize]="pageSize" [pageIndex]="pageNumber - 1"
                    [pageSizeOptions]="[5, 10, 20, 30]" showFirstLastButtons (page)="onPageChange($event)">
                </mat-paginator>

            </div>

        </div>

        <!-- ================= TABLE WRAPPER ================= -->
        <div class="relative overflow-x-auto w-full">

            <table mat-table [dataSource]="dataSource" class="min-w-[700px] w-full
               border border-gray-300
               divide-y divide-gray-300
               table-fixed
               text-sm md:text-base">

                <!-- SR NO -->
                <ng-container matColumnDef="srNo">
                    <th mat-header-cell *matHeaderCellDef class="w-[70px] text-center !bg-[#dd3d4f] border-r text-white">
                        Sr No.
                    </th>

                    <td mat-cell *matCellDef="let row; let i = index" class="text-center border-r text-[12px]">
                        {{ (pageNumber - 1) * pageSize + i + 1 }}
                    </td>
                </ng-container>


                <!-- Applied Date -->
                <ng-container matColumnDef="appliedDate">
                    <th mat-header-cell *matHeaderCellDef class="w-[70px] text-center !bg-[#dd3d4f] border-r text-white">Applied
                        Date</th>
                    <td mat-cell *matCellDef="let row" class="border-r">
                        {{ row.applieddate | date:'dd-MM-yyyy' }}
                    </td>
                </ng-container>

                <!-- From Date -->
                <ng-container matColumnDef="fromDate">
                    <th mat-header-cell *matHeaderCellDef class="w-[70px] text-center !bg-[#dd3d4f] border-r text-white">From
                        Date</th>
                    <td mat-cell *matCellDef="let row" class="border-r">
                        {{ row.fromDate | date:'dd-MM-yyyy' }}
                    </td>
                </ng-container>

                <!-- To Date -->
                <ng-container matColumnDef="toDate">
                    <th mat-header-cell *matHeaderCellDef class="w-[70px] text-center !bg-[#dd3d4f] border-r text-white">To Date
                    </th>
                    <td mat-cell *matCellDef="let row" class="border-r">
                        {{ row.toDate | date:'dd-MM-yyyy' }}
                    </td>
                </ng-container>

                <!-- Leave Name -->
                <ng-container matColumnDef="leaveName">
                    <th mat-header-cell *matHeaderCellDef class="w-[70px] text-center !bg-[#dd3d4f] border-r text-white">Leave
                        Type</th>
                    <td mat-cell *matCellDef="let row" class="border-r">{{ row.leaveName }}</td>
                </ng-container>

                <!-- Description -->
                <ng-container matColumnDef="description">
                    <th mat-header-cell *matHeaderCellDef class="w-[70px] text-center !bg-[#dd3d4f] border-r text-white">
                        Description</th>
                    <td mat-cell *matCellDef="let row" class="border-r">{{ row.description }}</td>
                </ng-container>

                <!-- Status -->
                <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef class="w-[70px] text-center !bg-[#dd3d4f] border-r text-white">Status
                    </th>
                    <td mat-cell *matCellDef="let row">
                        <span [ngClass]="{
        'text-yellow-600': row.status === 'Pending',
        'text-green-600': row.status === 'Approved',
        'text-red-600': row.status === 'Unapproved'
      }">
                            {{ row.status }}
                        </span>
                    </td>
                </ng-container>


                <!-- ROWS -->
                <tr mat-header-row *matHeaderRowDef="displayedColumns" class="!h-9">
                </tr>

                <tr mat-row *matRowDef="let row; columns: displayedColumns" class="hover:bg-gray-100 !h-9">
                </tr>

            </table>

        </div>
    </div>
</div>
