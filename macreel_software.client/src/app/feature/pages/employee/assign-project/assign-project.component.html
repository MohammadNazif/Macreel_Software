<div class="bg-gray-50 p-2">
  <div class="bg-white shadow rounded-lg p-1">

    <h1 class="ml-2 text-lg font-semibold text-[#444]">
      Assigned Project List
    </h1>

    <app-generic-table
      [columns]="projectsColumns"
      [data]="projectsData"
      [loading]="loading"
      [showActions]="false">
    </app-generic-table>

  </div>
</div>

<!-- ACTION TEMPLATE -->
<ng-template #filesTemplate let-row>
  <div class="flex gap-2 justify-center">

    <!-- Assign Employee -->
    <button
      class="w-7 h-7 text-green-600 hover:bg-green-100 rounded"
      title="Assign Employee"
      (click)="viewEmployee(row)">
       <i class="fa-solid fa-user-plus"></i>
    </button>

    <!-- Show Assigned Employees -->
    <button
      class="px-2 py-1 text-blue-600 hover:underline"
      (click)="showAssignedEmployees(row)">
      <i class="fa-solid fa-users mr-1"></i>
    </button>

  </div>
</ng-template>


<!-- <ng-template #filesTemplate let-row>
  <div class="flex justify-center">
    <button
      class="w-7 h-7 text-green-600 hover:bg-green-100 rounded"
      title="Assign Employee"
      (click)="viewEmployee(row)">
      ðŸ‘¤
    </button>
  </div>
</ng-template> -->

<ng-template #filesTemplate let-row>
  <div class="flex justify-center">
    <button
      class="px-2 py-1 text-blue-600 hover:underline"
      (click)="showAssignedEmployees(row)">
      Show Employees
    </button>
  </div>
</ng-template>


<!-- MODAL -->
<div *ngIf="showEmployeeModal"
     class="fixed inset-0 bg-black/40 flex items-center justify-center z-50">

  <div class="bg-white w-[420px] rounded-xl shadow-xl flex flex-col">

    <!-- Header -->
    <div class="flex justify-between items-center px-4 py-2 border-b">
      <h3 class="font-semibold">Select Employees</h3>
      <button (click)="closeModal()">âœ•</button>
    </div>

    <!-- Body -->
    <div class="p-4">

      <mat-form-field class="w-full">
        <mat-label>Select Employees</mat-label>

        <mat-chip-grid #chipGrid>
          <mat-chip-row
            *ngFor="let emp of selectedEmployees"
            (removed)="removeEmployee(emp)">
            {{ emp.empName }}
            <button matChipRemove>âœ•</button>
          </mat-chip-row>

          <input
            placeholder="Search employee..."
            [formControl]="employeeCtrl"
            [matAutocomplete]="autoEmp"
            [matChipInputFor]="chipGrid" />
        </mat-chip-grid>

        <mat-autocomplete
          #autoEmp="matAutocomplete"
          (optionSelected)="onEmployeeSelected($event)">
          <mat-option *ngFor="let emp of employees" [value]="emp.id">
            {{ emp.empName }}
          </mat-option>
        </mat-autocomplete>

      </mat-form-field>

    </div>

    <!-- Footer -->
    <div class="flex justify-end gap-2 px-4 py-2 border-t">
      <button (click)="closeModal()" class="border px-4 py-1 rounded">
        Cancel
      </button>

      <button
        (click)="submit()"
        [disabled]="!selectedEmployees.length"
        class="bg-[#dd3d4f] text-white px-4 py-1 rounded disabled:opacity-50">
        Submit
      </button>
    </div>

  </div>
</div>


<!-- EMPLOYEE LIST MODAL -->
<div *ngIf="showEmployeeListModal"
     class="fixed inset-0 bg-black/40 flex items-center justify-center z-50">

  <div class="bg-white w-[650px] rounded-xl shadow-xl">

    <!-- Header -->
    <div class="flex justify-between items-center px-4 py-2 border-b">
      <h3 class="font-semibold">Assigned Employees</h3>
      <button (click)="showEmployeeListModal = false">âœ•</button>
    </div>

    <!-- Body -->
    <div class="p-4 max-h-[400px] overflow-auto">

      <table class="w-full border text-sm">
        <thead class="bg-gray-100">
          <tr>
            <th class="border px-2 py-1">Name</th>
            <th class="border px-2 py-1">Mobile</th>
            <th class="border px-2 py-1">Designation</th>
            <th class="border px-2 py-1">Category</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let emp of assignedEmployees">
            <td class="border px-2 py-1">{{ emp.empName }}</td>
            <td class="border px-2 py-1">{{ emp.mobile }}</td>
            <td class="border px-2 py-1">{{ emp.designation }}</td>
            <td class="border px-2 py-1">{{ emp.category }}</td>
          </tr>
        </tbody>
      </table>

      <p *ngIf="!assignedEmployees.length" class="text-center text-gray-500">
        No employees found
      </p>

    </div>

    <!-- Footer -->
    <div class="flex justify-end px-4 py-2 border-t">
      <button
        (click)="showEmployeeListModal = false"
        class="border px-4 py-1 rounded">
        Close
      </button>
    </div>

  </div>
</div>
