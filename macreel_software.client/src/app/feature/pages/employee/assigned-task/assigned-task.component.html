<div class="bg-gray-50 p-2 md:p-2">
  <!-- Assigned Leaves Table -->
  <div class="bg-white shadow rounded-lg p-1">
    <!-- HEADER -->
    <div
      class="flex flex-col md:flex-row md:items-center md:justify-between gap-1 mb-1"
    >
      <!-- LEFT SIDE: TITLE -->
      <h1
        class="ml-2 text-lg md:text-[16px] font-semibold text-[#444] text-center md:text-left"
      >
        Assigned Tasks
      </h1>

      <!-- RIGHT SIDE: SEARCH + PAGINATOR (together) -->
      <div class="flex items-center gap-2">
        <!-- SEARCH -->
        <div class="relative">
          <input
            type="text"
            placeholder="Search Leave"
            [formControl]="searchControl"
            class="w-full pl-10 pr-3 py-[6px] text-[12px] rounded-lg bg-[#F6F7FB] border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#C5192F] table-search"
          />
          <i
            class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"
          >
          </i>
        </div>

        <!-- PAGINATOR -->
        <mat-paginator
          [length]="totalRecords"
          [pageSize]="pageSize"
          [pageIndex]="pageNumber - 1"
          [pageSizeOptions]="[10, 20, 30]"
          showFirstLastButtons
          (page)="onPageChange($event)"
        >
        </mat-paginator>
      </div>
    </div>

    <!-- ================= TABLE WRAPPER ================= -->
    <div class="relative overflow-x-auto w-full">
      <table
        mat-table
        [dataSource]="dataSource"
        class="min-w-[700px] w-full border border-gray-300 divide-y divide-gray-300 table-fixed text-sm md:text-base table"
      >
        <!-- SR NO -->
        <ng-container matColumnDef="srNo">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="w-[40px] text-center !bg-[#dd3d4f] border-r text-white"
          >
            Sr No.
          </th>

          <td
            mat-cell
            *matCellDef="let row; let i = index"
            class="text-center text-[12px] border-r"
          >
            {{ (pageNumber - 1) * pageSize + i + 1 }}
          </td>
        </ng-container>

        <!-- Title -->
        <ng-container matColumnDef="title">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="w-[100px] text-center !bg-[#dd3d4f] border-r text-white"
          >
            Title
          </th>
          <td mat-cell *matCellDef="let row" class="border-r">
            {{ row.title }}
          </td>
        </ng-container>

        <!-- Assigned By -->
        <ng-container matColumnDef="assignedBy">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="w-[70px] text-center !bg-[#dd3d4f] border-r text-white"
          >
            Assigned By
          </th>
          <td mat-cell *matCellDef="let row" class="border-r">
            {{ row.assignedByName }}
          </td>
        </ng-container>
        <!-- Assigned Date -->
        <ng-container matColumnDef="assignedDate">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="w-[60px] text-center !bg-[#dd3d4f] border-r text-white"
          >
            Assigned Date
          </th>
          <td mat-cell *matCellDef="let row" class="border-r">
            {{ row.assignedDate | date: "dd-MM-yyyy" }}
          </td>
        </ng-container>
        <!-- Completion Date -->
        <ng-container matColumnDef="completionDate">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="w-[60px] text-center !bg-[#dd3d4f] border-r text-white"
          >
            Completion Date
          </th>
          <td mat-cell *matCellDef="let row" class="border-r">
            {{ row.completedDate | date: "dd-MM-yyyy" }}
          </td>
        </ng-container>
        <!-- Task Status -->
        <ng-container matColumnDef="taskStatus">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="w-[60px] text-center !bg-[#dd3d4f] border-r text-white"
          >
            Task Status
          </th>
          <td mat-cell *matCellDef="let row" class="border-r">
            {{ row.taskStatus }}
          </td>
        </ng-container>
        <!-- Action -->
        <ng-container matColumnDef="action">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="w-[70px] text-center !bg-[#dd3d4f] text-white"
          >
            Action
          </th>
          <td mat-cell *matCellDef="let element" class="px-1 py-1 text-center">
            <button
              *ngIf="element.taskStatus === 'Pending'"
              (click)="openModal(element.id)"
              class="text-green-700 p-2 rounded-full hover:bg-green-100 mr-1 text-[12px]"
            >
              <i class="fa fa-pencil"></i>
            </button>
          </td>
        </ng-container>

        <!-- ROWS -->
        <tr
          mat-header-row
          *matHeaderRowDef="displayedColumns"
          class="!h-9"
        ></tr>

        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          class="hover:bg-gray-100 !h-9"
        ></tr>
      </table>
    </div>
  </div>
</div>

<!-- MODAL BACKDROP -->
<div
  *ngIf="isModalOpen"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
>
  <!-- MODAL CARD -->
  <div
    class="bg-white w-full max-w-3xl rounded-lg shadow-lg relative max-h-[90vh] overflow-y-auto"
  >
    <!-- CLOSE BUTTON -->
    <button
      type="button"
      (click)="closeModal()"
      class="absolute top-3 right-3 text-gray-500 hover:text-red-600 text-lg"
    >
      <i class="fa-solid fa-xmark"></i>
    </button>

    <!-- MODAL HEADER -->
    <div class="border-b px-5 py-3">
      <h2 class="text-lg font-semibold text-gray-700">Update Task Status</h2>
    </div>

    <!-- MODAL BODY -->
    <form
      [formGroup]="statusForm"
      (ngSubmit)="onSubmitStatus()"
      class="px-5 py-4 space-y-4"
    >
      <!-- ROW 1 -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1"
            >Status</label
          >
          <input
            type="text"
            formControlName="taskStatus"
            readonly
            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#C5192F]"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1"
            >Task Title</label
          >
          <input
            type="text"
            formControlName="taskTitle"
            readonly
            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#C5192F]"
          />
        </div>
      </div>

      <!-- ROW 2 -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1"
            >Assigned Date</label
          >
          <input
            type="date"
            formControlName="assignedDate"
            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#C5192F]"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1"
            >Completion Date</label
          >
          <input
            type="date"
            formControlName="completedDate"
            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#C5192F]"
          />
        </div>
      </div>

      <!-- ROW 3 -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1"
            >Description</label
          >
          <textarea
            rows="3"
            formControlName="description"
            readonly
            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#C5192F]"
          ></textarea>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">
            Comment (If Any)
          </label>
          <textarea
            rows="3"
            formControlName="comment"
            class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#C5192F]"
          ></textarea>
        </div>
      </div>

      <!-- DOCUMENT UPLOAD -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">
            Upload Document 1
          </label>
          <input
            type="file" (change)="onFileSelected($event)"
        formControlName="Document"
            formControlName="document1"
            class="w-full text-sm border border-gray-300 rounded-md file:px-3 file:py-2 file:border-0 file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">
            Upload Document 2
          </label>
          <input
            type="file"
            (change)="onFileSelected2($event)"
            formControlName="document2"
            class="w-full text-sm border border-gray-300 rounded-md file:px-3 file:py-2 file:border-0 file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200"
          />
        </div>
      </div>

      <!-- MARK COMPLETE -->
      <div class="flex items-center gap-3">
        <input
          type="checkbox"
          formControlName="isCompleted"
          class="w-4 h-4 text-[#C5192F] border-gray-300 rounded"
        />
        <label class="text-sm font-medium text-gray-700">
          Mark this task as completed
        </label>
      </div>

      <!-- ACTION BUTTON -->
      <div class="flex justify-center pt-3 border-t">
        <button
          type="submit"
          [disabled]="statusForm.invalid"
          class="px-6 py-2 text-sm rounded-md text-white bg-[#C5192F] hover:bg-[#b3162a] disabled:opacity-50"
        >
          Submit
        </button>
      </div>
    </form>
  </div>
</div>
